'use strict';const acf_dataset={tables:document.querySelectorAll('.ds_table.ds'),code:document.querySelector('.ds_code'),timout:null,api:'/datasets/public/wp_api/global_datasets/',init(){if(this.tables)
this.tables.forEach(table=>this.init_table(table))},init_table(table,retry=1){if(retry>3)
return this.error(table);let id=table.getAttribute('data-id');if(!id)
return;let url=this.api+id;fetch(url).then(resp=>resp.json()).then(data=>{if(!data.sample_data)
return this.init_table(table,retry+1);this.init_data_sample(data,table);let dict_elm=table.closest('section').querySelector('.ds_table.dict');this.init_dictionary(data,dict_elm);this.code.textContent=JSON.stringify(data.sample_data,null,2);if(table.closest('section.dataset').classList.contains('is_scraper')){this.prism(this.code.closest('.ds_code_wrapper'))}}).catch(e=>this.init_table(table,retry+1))},init_data_sample(ds_data,table){let dictionary=ds_data.dictionary.map(item=>item.name);let titles_elm=table.querySelector('thead tr');dictionary.forEach(title=>{let elm=document.createElement('th');elm.innerHTML=title.replaceAll('_',' ');titles_elm.append(elm)});let data=ds_data.sample_data;let tbody_elm=table.querySelector('tbody');data.forEach(row=>{let tr=document.createElement('tr');tr=this.create_data_row(row,dictionary,tr);tbody_elm.append(tr)})},create_data_row(data,dictionary,tr){dictionary.forEach(title=>{let td=document.createElement('td');try{if(title=='type'){td.innerHTML=this.get_svg(data[title]);td.innerHTML=td.innerHTML+(typeof data[title]=='object'?JSON.stringify(data[title]):data[title])}else{td.textContent=typeof data[title]=='object'?JSON.stringify(data[title],null,4):data[title];if(typeof data[title]=='object'){td.classList.add('object');td.setAttribute('data-title',title);td.addEventListener('click',e=>{brd_modals.init_modal('popup-245660',!1,e.target)})}}}catch(e){td.innerHTML=data[title]}
tr.append(td)});return tr},get_svg(name){return'<svg role="presentation" viewbox="0 0 15 15"><use href="#ic_'+name+'"></use>'},init_dictionary(ds_data,table){let dictionary=Object.keys(ds_data.dictionary[0]);let type=dictionary[1];dictionary[1]=dictionary[2];dictionary[2]=type;let titles_elm=table.querySelector('thead tr');dictionary.forEach(title=>{let elm=document.createElement('th');elm.innerHTML=title.replaceAll('_',' ');titles_elm.append(elm)});let data=ds_data.dictionary;let tbody_elm=table.querySelector('tbody');data.forEach(row=>{let tr=document.createElement('tr');tr=this.create_data_row(row,dictionary,tr);tbody_elm.append(tr)})},search_attr(val){clearTimeout(this.timeout);this.timeout=setTimeout(()=>{let rows=document.querySelectorAll('.ds_table.dict tbody tr');if(!rows.length)
return;rows.forEach(row=>{let haystack=row.querySelector('td');row.style.display=haystack.innerText.includes(val)?'':'none'})},350)},highlight(e){let target_id=e.target.getAttribute('aria-controls');let target=document.querySelector('#'+target_id);if(target.classList.contains('init'))
return;this.prism(target)},prism(target){Prism.highlightAllUnder(target,!1,()=>{target.classList.add('init')})},error(table){let dict_elm=table.closest('section').querySelector('.ds_table.dict');let err_elm=document.createElement('div');err_elm.classList.add('p-3');err_elm.classList.add('text-center');err_elm.innerHTML='Faild to fetch data, try to reload the page';let err_elm_dict=err_elm.cloneNode(!0);let table_p=table.parentNode;let dict_elm_p=dict_elm.parentNode;table_p.replaceChild(err_elm,table);dict_elm_p.replaceChild(err_elm_dict,dict_elm)}};acf_dataset.init()